<!DOCTYPE html>
<html lang="en">

<%- include('./layouts/header') %>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <%- include('./layouts/sidebar') %>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <%- include('./layouts/topbar') %>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <h1 class="h3 mb-4 text-gray-800">All Adoption Applications</h1>

          <!-- Flash Message -->
          <% if (message && message.length > 0) { %>
            <div class="alert alert-info"><%= message %></div>
          <% } %>

          <!-- ================= PENDING APPLICATIONS ================= -->
          <h3 class="text-warning mb-3">Pending Applications</h3>
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th>Application ID</th>
                <th>Pet Name</th>
                <th>Species</th>
                <th>Adopter Name</th>
                <th>Adopter Email</th>
                <th>Message</th>
                <th>Status</th>
                <th>Submitted On</th>
                <th>Actions</th>
              </tr>
            </thead> 
            <tbody>
              <% pendingApplications.forEach(app => { %>
                <tr>
                  <td><%= app._id %></td>
                  <td><%= app.pet.name %></td>
                  <td><%= app.pet.species %></td>
                  <td><%= app.adopter.name %></td>
                  <td><%= app.adopter.email %></td>
                  <td><%= app.message %></td>
                  <td><span class="badge bg-warning text-dark"><%= app.status %></span></td>
                  <td><%= new Date(app.submittedOn).toLocaleString() %></td>
                  <td>
                    <div style="display:flex; gap:10px;">
                      <form action="/admin/applications/approve/<%= app._id %>" method="POST" style="display:inline;">
                        <button class="btn btn-success btn-sm">Approve</button>
                      </form>
                      <form action="/admin/applications/reject/<%= app._id %>" method="POST" style="display:inline;">
                        <button class="btn btn-danger btn-sm">Reject</button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <!-- ================= APPROVED APPLICATIONS ================= -->
          <h3 class="text-success mt-5 mb-3">Approved Applications</h3>
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th>Application ID</th>
                <th>Pet Name</th>
                <th>Species</th>
                <th>Adopter Name</th>
                <th>Email</th>
                <th>Message</th>
                <th>Status</th>
                <th>Submitted On</th>
              </tr>
            </thead>
            <tbody>
              <% approvedApplications.forEach(app => { %>
                <tr>
                  <td><%= app._id %></td>
                  <td><%= app.pet.name %></td>
                  <td><%= app.pet.species %></td>
                  <td><%= app.adopter.name %></td>
                  <td><%= app.adopter.email %></td>
                  <td><%= app.message %></td>
                  <td><span class="badge bg-success"><%= app.status %></span></td>
                  <td><%= new Date(app.submittedOn).toLocaleString() %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <!-- ================= REJECTED APPLICATIONS ================= -->
          <h3 class="text-danger mt-5 mb-3">Rejected Applications</h3>
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th>Application ID</th>
                <th>Pet Name</th>
                <th>Species</th>
                <th>Adopter Name</th>
                <th>Email</th>
                <th>Message</th>
                <th>Status</th>
                <th>Submitted On</th>
              </tr>
            </thead>
            <tbody>
              <% rejectedApplications.forEach(app => { %>
                <tr>
                  <td><%= app._id %></td>
                  <td><%= app.pet.name %></td>
                  <td><%= app.pet.species %></td>
                  <td><%= app.adopter.name %></td>
                  <td><%= app.adopter.email %></td>
                  <td><%= app.message %></td>
                  <td><span class="badge bg-danger"><%= app.status %></span></td>
                  <td><%= new Date(app.submittedOn).toLocaleString() %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>

        </div>
        <!-- End of Page Content -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <%- include('./layouts/footer') %>
    </div>
  </div>

</body>
</html>
